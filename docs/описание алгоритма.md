Предварительные расчеты:

- Загрузить маршрутный граф  N,E (длина ребра Le)
- Загрузить ледовые условия по неделям T1, T2 ... Tn
- Рассчитать интегральные ледовые условия для каждого ребра E на каждый момент времени T1, T2 ... Tn
- Определить функцию ice_condition(e,t) которая возвращает интегральные ледовые условия ребра в момент времени t
- Определить функцию расчета кратчайшего пути на графе N,E find_path(s,d,ts,v,k,v_ice,k_ice) -> t,p где t кратчайшее время, p кратчайший маршрут, s,d in N начало и конец маршрута, ts - время начала движения, v скорость судна, k - коэффициенты замедления судна,  v_ice - скорость ледокола, k_ice - коэффициенты замедления ледокола. Если v_ice,k_ice отсутствуют то рассчитывается самостоятельное движение, иначе движение в караване с одним судном. Если точка назначения d не указана рассчитываютcя t,p для всех достижимых вершин 
- Для каждого судна i in vessels (скорость судна Vi, коэффициенты замедления Ki, точка старта Si, точка финиша Di)
    - рассчитать время достижения из Si каждой вершины N без проводки self_move_cost(i,n), n in N
    - рассчитать время достижения конечной точки маршрута Di при условии полной проводки самым медленным ледоколом ice_move_cost(i,Di)


Вспомогательный алгоритм "Оценка суммарного времени проводки"
Вход: ледокол l,  суда для проводки v1,v2,v3 (v2 и v3 могут быть пустыми), точка начала проводки nf, точка конца проводки nl
вариации алгоритма - рассчитать время для конкретного стартового местонахождения ледокола или считать что ледокол прибыл на место проводки в последний момент
- Рассчитать возможное время прибытия каждого судна и ледокола до точки начала проводки nf (с учетом времени начала движения каждого судна)
- время начала проводки Tf = max(возможное время прибытия) если указано место ледокола, то с учетом ожидания ледокола
- рассчитать время движения каравана до точки nl (с учетом самого медленного судна) Tl время окончания проводки
- рассчитать оптимальные маршруты для каждого судна до точки назначения
Суммарное время проводки = общее время нахождения всех судов на маршруте с учетом ожидания формирования каравана (без учета времени ледокола)

Вспомогательный алгоритм - поиск оптимальной точки формирования и расформирования каравана
вход суда для проводки v1,v2,v3


Грубая оценка решения:
- Для каждого судна i in vessels 
    - худшее время движения = self_move_cost(i,Di)
    - суб оптимальное время движения = ice_move_cost(i,Di)
    - оценка полезности проводки priority = self_move_cost(i,Di) - ice_move_cost(i,Di)

Взять очередное незапланированное судно v1 с наибольшей полезностью проводки
    Добавить к расчету суда Vr которые еще не помечены как запланированные  время начала движения которых в радиусе TR от выбранного и место старта в радиусе LR от выбранного
    Сформировать все комбинации судов (vi) in Vr, (vi,vj) in Vr для проводки
    установить точку начала проводки nf = точка старта судна v1
    установить точку конца проводки nl = точка назначения судна v1



    "waybill": [ // описание пути
            {"event":"move", // move - начало самостоятельного движения из точки, wait - начало ожидания, formation - движение в караване из точки, fin - прибытие в конечную точку,
             "point":11, //где произошло событие
             "time":"01.03.2022 00:00" //когда произошло событие
            }
            {"event":"wait", "point":16, "time":"01.03.2022 08:00"}
            {"event":"formation", "point":16, "time":"02.03.2022 08:00"}
            {"event":"formation", "point":15, "time":"03.03.2022 08:00"}
            {"event":"move", "point":18, "time":"03.03.2022 10:00"}
            {"event":"fin", "point":41, "time":"04.03.2022 10:00"}
        ]




Визуализация:

Нарисовать обстановку на время (т)

current_event = [0,1,0,0,0]

real_time = 1s
sim_time = 1h
for t = (start_t,fin_t,sim_time):
    найти все корабли которые пора рисовать
    for v in Vessels:
        v.waybill[current_event[v]] 
wait real_time




Время кадра реальное (1 секунды)
Время кадра в симуляции (1 час)

Цикл т от начала до конца
 т = т + шаг симуляции
Нарисовать обстановку на время (т)

============================================

Предварительные рассчеты 
1. Посчитать ледовые условия (+)
2. Посчитать кратчайший путь в каждую точку при самостоятельном движении (+)
3. Посчитать оценку от начала до конца маршрута при самостоятельном движении - верхняя оценка времени (+)
4. Посчитать оценку от начала до конца маршрута при движении с идеальным ледоколом - нижняя оценка времени (+)
5. Посчитать приоритет проводки (разница между верхней и нижней оценкой)
6. Посчитать время движения по всем возможным путям на графе (между любыми парами вершин) для идеального (?) ледокола в лучших (?) ледовых условиях за период

Алгоритм определения время готовности ледокола к проводке
время     1 2 3 4 5 6 7 8 9 10 11 12 13 14
Ледокол   о             х      о        х
Новая                        ! о        х
 
1. Взять текущее расписание движения ледокола
2. На вход алгоритма подается время когда он должен начать проводку 
3. Если на это время он не занят то найти ближайшее время освобождения в прошлом иначе в будущем
4. Определить ближайшее время резервирования в будущем (может быть пустым тогда присваеваем максимальное время)
5. Полученные границы это окно времени в которое ледокол может взять новую проводку (быть зарезервированным)

Подбор ледокола и соседей для проводки
1. Назначить судно которое точно добавляется в проводку
2. Определить множество вершин которое оно может достичь самостоятельно - это допустимые точки начала проводки
3. Определить множество вершин из которых судно может самостоятельно доплыть до конечной точки маршрута - это допустимые точки конца проводки
4. Определить соседей - множество судов которые отплыли раньше (конкретное значение как параметр алгоритма например неделя)
5. Сформировать все возможные пары из допустимых множеств начала и конца проводки
6. Для каждой конфигурации соседей судов найти субоптимальное решение посчитать стоимость проводки ближайшим ледоколом (с учетом времени его освобождения) из точки старта в точку финиша если соседи сами плывут до дочки старта, отбросить все варианты для которых общее время проводки хуже времени самостоятельного движения. На выходе получаем множество кортежей из судов (основное + соседи) (?)
7. Сделать грубую оценку стоимости проводки для всех конфигураций судов из предыдущего шага и всех пар начал и конца проводки и всех доступных ледоколов =  время движения всех судов до начала проводки + время ожидания самого медленного судна + время проводки идеальным ледоколом + время достижения всеми судами конечной точки (в лучших ледовых условиях за период) Отбросить все конфигурации для которых суммарное время хуже субоптимального или для которых идеальный ледокол не успевает доплыть до от точки освобождения до начала места проводки или доплыть до точки следующего резервирования после окончания проводки
8. Для оставшихся на предыдущем шаге конфигураций проводимых судов и ледоколов посчитать точное время проводки и выбрать лучшее по выигрышу (тут может быть сравнение с бесконечностью то есть надо вместо бесконечности брать какое-то достаточно большое число видимо) и минимальное по времени задействования ледокола - если в начале или конце проводки начинаются легкие ледовые условия суда идут самостоятельно

Жадный алгоритм с приоритетом проводки
1. Выбрать судно с самым высоким приоритетом проводки
2. подобрать ледокол и соседей для проводки и записать в план расписание движения судов и ледокола
3. Отметить время и место резервирования и время и место освобождения ледокола
4. Вернуться на шаг 1
